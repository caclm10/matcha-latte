---
import { Image } from "astro:assets";

import { ingredients } from "@/data";
import { button } from "@/components/variants";
import DefaultLayout from "@/layouts/DefaultLayout.astro";
---

<DefaultLayout>
    <h1 class="text-5xl font-medium text-center" transition:name="ingredients">
        Bahan-bahan buat Matcha Latte
    </h1>

    <div
        class="grid grid-cols-3 gap-4 md:gap-8"
        id="ingredientImages"
        data-aos-id="ingredient-images"
        transition:name="images"
    >
        {
            ingredients.map((ingredient, index) => {
                const aos = index % 2 == 0 ? "fade-up" : "fade-down";

                return (
                    <div
                        class="relative"
                        data-aos={aos}
                        data-aos-duration="500"
                        data-aos-delay={(index + 1) * 500}
                        data-ingredient-image
                    >
                        <Image
                            src={ingredient.image}
                            alt={ingredient.imageAlt}
                            class="w-full aspect-square object-cover rounded-lg ring ring-primary"
                            transition:name={`ingredient-image-${ingredient.id}`}
                        />

                        <a
                            href={`/ingredients/${ingredient.id}`}
                            class="absolute inset-0"
                        >
                            <span class="sr-only">{ingredient.name}</span>
                        </a>
                    </div>
                );
            })
        }
    </div>

    <div class="flex justify-end">
        <a
            href="/steps/1"
            class={button()}
            data-aos="fade-right"
            data-aos-delay={ingredients.length * 500 + 500}
            data-aos-anchor="ingredientImages"
            transition:name="action-button"
        >
            <span>Mari kita buat</span>
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="1em"
                height="1em"
                viewBox="0 0 24 24"
                ><path
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 12h14m-7-7l7 7l-7 7"></path></svg
            >
        </a>
    </div>
</DefaultLayout>

<script>
    function removeAOS() {
        const urlSearchParams = new URLSearchParams(window.location.search);

        if (urlSearchParams.get("visited") === "1") {
            document.querySelectorAll(`[data-aos]`).forEach((element) => {
                element.removeAttribute("data-aos");
            });
        }
    }

    removeAOS();

    document.addEventListener("astro:after-swap", () => {
        removeAOS();
    });
</script>
